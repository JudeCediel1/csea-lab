%==================================================================%%	stead2grangerregmean%%calculates granger causality in source space, for regional dipoles from%besa %	%	Function definition function [n_sig_vec] = fmricluster2granger(filemat, plotflag, diff_flag, norm_flag);       if nargin < 2, plotflag = [], end    exp = 'emosteady'     for fileindex = 1 : size(filemat,1);            datamat = load(filemat(fileindex,:));             grangermat2 = datamat;                 if diff_flag        flipmat = grangermat2';        flipmatdiff = diff(flipmat);        flipmatdiff2 = diff(flipmatdiff);        grangermat2 = flipmatdiff2';         end                if norm_flag            for channel = 1:size(grangermat2,1)            grangermat2(channel,:) = grangermat2(channel,:) ./(max(grangermat2(channel,:))-min(grangermat2(channel,:)));            end        end           %if plotflag, figure(1), plot(grangermat2'), end         % calculate granger stats        disp('granger analysis')        uroot = aks_check_covariance_stationarity(grangermat2,2); if plotflag, figure(10), plot(uroot), hold off, end        if sum(uroot) > 0, disp([filemat(fileindex,:) '  has uroot > 0']), pause, end        [bic(fileindex),aic] = aks_find_model_order(grangermat2,2,10);        [ret] = aks_granger_regress_as(grangermat2,2);        [GC,FS] = aks_findsignificance(ret.gc,ret.fs,.001, 1);                eval(['save ' filemat(fileindex,:) '.ret.mat -struct ret'])                n_sig_vec(fileindex) = length(find(GC > 0));                        if plotflag, figure, aks_plotcausality(FS, 2), title(filemat(fileindex,:)), pause(1), endend