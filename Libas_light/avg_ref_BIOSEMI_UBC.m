function ref = avg_ref_BIOSEMI_UBC(filemat);%this function to be applied to the at files (SCADS format avg files)%produced by emegsavg, after preprocessing and editing performed with avg%ref functions off. if unsure open with a = readavgfile(filepath here) and%check that last row (65) is all zeros. there should be however 64 lines of%valid EEG ... good luck. for index = 1:size(filemat,1);         [matrix,File,Path,FilePath,NTrialAvgVec,StdChanTimeMat,...	SampRate,AvgRef,Version,MedMedRawVec,MedMedAvgVec,EegMegStatus,...    NChanExtra,TrigPoint,HybridFactor,HybridDataCell,DataTypeVal]  = ReadAvgFile(deblank(filemat(index,:)));               matrix = matrix(1:64,:);         mean_col = mean(matrix', 2);        ref = bsxfun(@minus, matrix, mean_col');            SaveAvgFile([deblank(filemat(index,:)) '.ar'] ,ref,NTrialAvgVec,StdChanTimeMat, ...    SampRate,MedMedRawVec,MedMedAvgVec,EegMegStatus,NChanExtra,TrigPoint,HybridFactor,...    HybridDataCell,DataTypeVal)                  end