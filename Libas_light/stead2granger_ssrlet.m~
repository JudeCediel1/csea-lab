%==================================================================%%	stead2grangerregmean%%calculates granger causality in source space, for regional dipoles from%besa %	%	Function definition function [n_sig_vec] = stead2granger_ssrlet(filemat, plotflag, diff_flag, norm_flag);       if nargin < 2, plotflag = [], end    exp = 'emosteady'         for fileindex = 1 : size(filemat,1);            ERPmat = ReadAvgFile(deblank(filemat(fileindex,:)));                 datamat = ERPmat([34 122 37 105 46 109 48 99 58 97 60 86 65 91 71 84],:);        %grangermat2 = datamat(:,650:6:1300); right for                 if diff_flag        flipmat = grangermat2';        flipmatdiff = diff(flipmat);         grangermat2 = flipmatdiff';         end                if norm_flag            for channel = 1:size(grangermat2,1)            grangermat2(channel,:) = grangermat2(channel,:) ./(max(grangermat2(channel,:))-min(grangermat2(channel,:)));            end        end                             if plotflag, figure(1), plot(grangermat2'), pause (1), end         % calculate granger stats        disp('granger analysis')         uroot = aks_check_covariance_stationarity(grangermat2,2); if plotflag, figid = figure(2), set(figid,'Position',[126 680 560 420]), plot(uroot), hold off, end        if sum(uroot) > 0, disp([filemat(fileindex,:) '  has uroot > 0']), pause, end        [bic(fileindex),aic] = aks_find_model_order(grangermat2,2,14);        [ret] = aks_granger_regress_as(grangermat2,2);        [GC,FS] = aks_findsignificance(ret.gc,ret.fs,.002, 0);                       eval(['save ' deblank(filemat(fileindex,:)) '.ret.mat -struct ret'])                n_sig_vec(fileindex) = length(find(GC > 0));                        if plotflag, figid3 = figure, set(figid3,'Position',[96 7 560 420]), aks_plotcausality_as(FS, 2), title(filemat(fileindex,:)), pause(1), endend