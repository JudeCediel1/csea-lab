% Compute centres of gravity for CNV inverse solutions in polar coordinates for all subjectsfunction [cnvkon, cnvaph, cnvakt, cnvneu, pcc, pcr, corkon, coraph, corakt, corneu, meankon, meanaph, meanakt, meanneu] = correl_inv(lfdmat);nr_electrodes = 26;		% Number of electrodes to be used in the computation of the inverse reconstructionpath = 'h:\aphasie\sum\rmend'; namekon = 'konrm.txt';nameaph = 'aphrm.txt';nameakt = 'aktrm.txt';nameneu = 'neurm.txt';disp('Reading in data');name = sprintf('%s%s', path, namekon);			% Read in CNVs for different groupscnvkon = read_matrix(99,29,name);		% 99 is upper boundname = sprintf('%s%s', path, nameaph);cnvaph = read_matrix(99,29,name);name = sprintf('%s%s', path, nameakt);cnvakt = read_matrix(99,29,name);name = sprintf('%s%s', path, nameneu);cnvneu = read_matrix(99,29,name);disp('Average reference');cnvkon = avg_ref(cnvkon(:,1:26)')';			% Average referencecnvaph = avg_ref(cnvaph(:,1:26)')';cnvakt = avg_ref(cnvakt(:,1:26)')';cnvneu = avg_ref(cnvneu(:,1:26)')';disp('Reading in electrode locations');elpsph = read_elp('MadMac:matlab:data:aphasie:elp:26.elp');disp('Creating source space');diploc = srcspace_xyz(0.8, 0.1, -0.5);% dipsph = cart2polar(diploc);if nargin==0,	disp('Reading leadfield matrix');	lfdmat = read_matrix(5922, 26,  'MadMac:matlab:data:aphasie:elp:lead26_r08_-05.dat');	lfdmat = lfdmat';end;%avg_ref(lfdmat);disp('Computing pseudoinverse');G = pinv_tikh(lfdmat(1:nr_electrodes,:), 0.1);disp('Computing inverse solutions');invkon = inv_recon(G, cnvkon(:,1:nr_electrodes)', 3);invaph = inv_recon(G, cnvaph(:,1:nr_electrodes)', 3);invakt = inv_recon(G, cnvakt(:,1:nr_electrodes)', 3);invneu = inv_recon(G, cnvneu(:,1:nr_electrodes)', 3);disp('Computing principal component');[pcr, pcc] = princ_comp(invkon');		% Compute 1st principal components for columns (pcc) and rows (pcr)disp('Computing correlations');corkon = correl_mat(invkon', pcc');			% Compute correlations between subjects and pcrcoraph = correl_mat(invaph', pcc');corakt = correl_mat(invakt', pcc');corneu = correl_mat(invneu', pcc');disp('Computing mean correlations');meankon = mean(corkon);				%  Compute mean values for correlationsmeanaph = mean(coraph);meanakt = mean(corakt);meanneu = mean(corneu); disp('Plotting');figure(1);clf;plot(corkon, 'r'); hold on; plot(coraph, 'b');  plot(corakt, 'g');  plot(corneu, 'y'); legend('kon', 'aph', 'akt', 'neu', 1); hold on;plot(meankon, 'ro'); plot(meanaph, 'bo'); plot(meanakt, 'go'); plot(meanneu, 'yo');title('Korrelation der invertierten CNVs mit der ersten Hauptkomponente der invertierten CNVs der Kontrollgruppe');disp('Printing to file');print -dmfile 'MadMac:matlab:data:aphasie:pictures:correl_inv_pcacnv';