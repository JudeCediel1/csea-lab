% reads mat with single trials in 3rd dimension and creates at file of% averagefunction[specmat]=mat2spec(filemat, SampRate);for index = 1:size(filemat,1);         if ~isstruct(filemat);         matpath = deblank(filemat(index,:));    else        matpath = filemat(index).name;     end	   a = load(matpath);       outmat1 = a.epochmat;      powmatsum = zeros(size(outmat1,1), SampRate);     for trial = 1:size(outmat1,3);       data = regressionMAT(squeeze(outmat1(:, :, trial))); % caution, regression is done here.       [pow, phase, freqs] = FFT_spectrum(data, SampRate);      powmatsum = powmatsum + pow;   end     specmat = powmatsum./size(outmat1, 3);      [File,Path,FilePath]=SaveAvgFile([matpath '.spec'],specmat,[],[], size(outmat1,2)./SampRate.*1000);    end