% get_veog.m : reads scads format at* file and estimates vertival eog voltage% for each timepoint by getting the difference% between elcs 127 and 26 as well as 126 and 8% put together by andreas 01 (in a hurry - improvements welcome)function [meanveog, veogvec_L, veogvec_R] = get_veog(infilemat, bslvec); if nargin < 2	bslvec = input('please insert vector [a:b] for baseline segment in samplepoints  ')endif nargin < 1		[NFiles,infilemat]=ReadFileNames([],'*.at*','select scads at* file(s)');	endNFiles = size(infilemat, 1);for Fileindex = 1 : NFiles; 			[ERPmat,File,Path,FilePath,NTrialAvgVec,StdChanTimeMat,Fsamp] = readavgfile(infilemat(Fileindex, :));		ERPmat = bslcorr(ERPmat, bslvec);		veogvec_L = ERPmat(127,:) - ERPmat(26,:);	veogvec_R = ERPmat(126,:) - ERPmat(8,:);	meanveog = mean([veogvec_L; veogvec_R]);			filename = infilemat(Fileindex, 1:length(infilemat(Fileindex,:) - 3));		% find dots and hyphens in filename		colstring = findstr(filename, ':')	fnamestartInd = colstring(length(colstring))		dotindices = findstr(filename(fnamestartInd:length(filename)), '.')	hypindices = findstr(filename(fnamestartInd:length(filename)), '-')			filename(fnamestartInd:length(filename))		filename(fnamestartInd-1+dotindices) = ['_'];	filename(fnamestartInd-1+hypindices) = ['_'];		%eval(['save ' filename  '.ve   veogmatLR   -ascii']) 		% build outmat	% 1. fnamematrix first column		fnameshort = filename(fnamestartInd+1:length(filename));			for ind = 1:length(veogvec_L)		if ind == 1			fnameCharMat = [fnameshort ' '];		else			fnameCharMat = [fnameCharMat; fnameshort ' '];		end	end		% 2. samplerate		dummyvec = ones(length(veogvec_L), 1);	FsampVec = dummyvec .* Fsamp;		% 3. samplepoints	samppointvec = 1:length(veogvec_L);	samppointvec = samppointvec';		% 4 and 5: left and right veog	charveogvec_L = num2str(veogvec_L', 4);	charveogvec_R = num2str(veogvec_R', 4);		% blanks 	bl = '';	for ind = 1:length(veogvec_L)		if ind == 1			blankCharMat =  [' '];		else			blankCharMat = [blankCharMat; ' '];		end	end			%%%%%%%%%%%%%%%%%%%%%%%%%%%				outmat = [fnameCharMat num2str(FsampVec) blankCharMat num2str(samppointvec) blankCharMat charveogvec_L blankCharMat charveogvec_R];	%	fid = fopen([filename '.ve'], 'w')		[a_end,b_end] = size(outmat);		% 	% 	%  	for a = 1:a_end% 		%for b = 1:b_end% %  			%  			fprintf(fid, '%s ',outmat(a,:));% 		%end% 	% 		fprintf(fid, '\n');% % 	end% 		% 	fclose(fid);	end		