%==================================================================%%	stead2grangerregmean%%calculates granger causality in source space, for regional dipoles from%besa %	%	Function definition function [n_sig_vec] = stead2grangeranjagram(filemat, plotflag, diff_flag, norm_flag);       if nargin < 2, plotflag = [], end    exp = 'emosteady'         for fileindex = 1 : size(filemat,1);            ERPmat = read_mul(deblank(filemat(fileindex,:)));                 if size(ERPmat,2) == 1700,             ERPmat = ERPmat(:,1:2:1700);        end                datamat = [mean(ERPmat([43,44],:),1);mean(ERPmat([30,31,17,16],:),1);mean(ERPmat([18,33],:),1);...            mean(ERPmat([40,41],:),1);mean(ERPmat([22,23,9,10],:),1);mean(ERPmat([8,20],:),1)];        grangermat2 = datamat(:,225:4:800);                if diff_flag        flipmat = grangermat2';        flipmatdiff = diff(flipmat);         grangermat2 = flipmatdiff';         end                if norm_flag            for channel = 1:size(grangermat2,1)            grangermat2(channel,:) = grangermat2(channel,:) ./(max(grangermat2(channel,:))-min(grangermat2(channel,:)));            end        end                             if plotflag, figure(1), plot(grangermat2'), pause (1), end         % calculate granger stats        disp('granger analysis')         uroot = aks_check_covariance_stationarity(grangermat2,2); if plotflag, figid = figure(2), set(figid,'Position',[126 680 560 420]), plot(uroot), hold off, end        if sum(uroot) > 0, disp([filemat(fileindex,:) '  has uroot > 0']), pause, end        [bic(fileindex),aic] = aks_find_model_order(grangermat2,2,5);        [ret] = aks_granger_regress_as(grangermat2,2);        [GC,FS] = aks_findsignificance(ret.gc,ret.fs,.05, 0);                       eval(['save ' deblank(filemat(fileindex,:)) '.ret.mat -struct ret'])                n_sig_vec(fileindex) = length(find(GC > 0));                        if plotflag, figid3 = figure(3), set(figid3,'Position',[96 7 560 420]), aks_plotcausality(FS, 2), title(filemat(fileindex,:)), pause(1), endend