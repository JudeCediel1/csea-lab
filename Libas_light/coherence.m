%Berechnet Koherenzen zwischen Kanalpaaren für alle Paarungen der Inputmat. epochmat*% und gibt sie fuer die Targetfrequenz in den Mat. Cohmat* aus%Markus Härle, 31.07.2000 function[cohmat41, cohmatb41]=coherence(filename);%ascii-multiplexed Daten einlesenif nargin<1;epochmat= read_mul;else epochmat = read_mul(filename);endfilenamesig = strrep(filename, '.mul', '.coh');  %fuer output gleich veraendernfilenamebase = strrep(filename, '.mul', 'b.coh');  %fuer output gleich veraendern%Koherenzen berechnen fuer baseline- und signal-bereich%hier: 1017.25/512=1.9868 Hz Auflösung mit jeweil 150TP offsetchanmax=148;  	%hier Anz. der Kanaele eingeben;cohmat=zeros(chanmax,chanmax,257);cohmatb=zeros(chanmax,chanmax,257);xsum=zeros(1,257);xsumb=zeros(1,257);for chan1=1: 1: chanmax;   display (chan1);   for chan2=chan1: 1: chanmax;   	cohmatb(chan1,chan2,:) = COHERE(epochmat(chan1,[150:4495]),epochmat(chan2,[150:4495]),512,1017.25);   	cohmat(chan1,chan2,:) = COHERE(epochmat(chan1,[4645:8890]),epochmat(chan2,[4645:8890]),512,1017.25);      x=cohmat(chan1,chan2,[1:257]);xsum=x(:,:)+xsum(:,:);      xb=cohmatb(chan1,chan2,[1:257]);xsumb=xb(:,:)+xsumb(:,:);   end;   if chan1>1;      for chan2=1: 1: (chan1-1);         cohmatb(chan1,chan2,:) = COHERE(epochmat(chan1,[150:4495]),epochmat(chan2,[150:4495]),512,1017.25);   		cohmat(chan1,chan2,:) = COHERE(epochmat(chan1,[4645:8890]),epochmat(chan2,[4645:8890]),512,1017.25);   x=cohmat(chan1,chan2,[1:257]);xsum=x(:,:)+xsum(:,:);   xb=cohmatb(chan1,chan2,[1:257]);xsumb=xb(:,:)+xsumb(:,:);      end;	end;end;xsum=xsum./(chanmax*chanmax);		%durchschnitt berechnenxsumb=xsumb./(chanmax*chanmax);% Targetfrequenz aus Matritze herausholen ->21.Stelle =41.7228Hz;cohmat41=cohmat(:,:,21);cohmatb41=cohmatb(:,:,21);%den gabzen Schrott speichern;write_mat(cohmatb41,filenamebase);write_mat(cohmat41,filenamesig);title (['mean coherence over all chan and freq' filename]);%COHERE(epochmat(1,[4645:8890]),epochmat(2,[4645:8890]),512,1017.25); %Dummy fuer scalierunghold on;plot(xsum(1,[1:257]),'r');plot(xsumb(1,[1:257]),'b');hold off;title ([ 'signal  - Run: ' filename]);contourf(cohmat41);title ([ 'baseline  - Run: ' filename]);figure;contourf(cohmatb41);