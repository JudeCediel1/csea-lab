% magno_waveletfunction [ampmat] = magno_wavelet(filemat, targetfreq); % 1. read data[data,File,Path,FilePath,NTrialAvgVec,StdChanTimeMat,...	SampRate] = ReadAvgFile(deblank(filemat(1,:))); NPointsold = size(data,2);  % Npoints runden auf naechste 2erpotenz  matsize = 2;  potsize = 2;  while matsize < NPointsold;  potsize = potsize + 1;  matsize = 2^potsize;  end  NPointsNew = matsize;    Freq_res = SampRate ./ NPointsNew;     waveletindex = round(targetfreq ./ Freq_res) + 1    [wavelet] = gener_wav(NPointsNew, 1, waveletindex, waveletindex);    waveletMat = repmat(wavelet, 129,1)';      disp('size of waveletMatrix')  disp(size(wavelet))  disp (' frequency step for delta_f0 = 1 is ')  disp(SampRate/NPointsNew)        for fileindex = 1: size(filemat,1);            Data = ReadAvgFile(deblank(filemat(fileindex,:)));           data_pad = [Data zeros(129, NPointsNew-NPointsold)]';         M2 = 80;    squarecos1 = (cos(pi/2:(pi-pi/2)/M2:pi-(pi-pi/2)/M2)).^2;    squarecos2 = (cos(0:(pi-pi/2)/M2:pi/2-(pi-pi/2)/M2)).^2;    data_tap = [data_pad(1:M2,:).* repmat(squarecos1,129,1)' ; data_pad(M2+1:length(data_pad)-M2-(NPointsNew-NPointsold),:); data_pad(length(data_pad)-M2+1-(NPointsNew-NPointsold):length(data_pad)-(NPointsNew-NPointsold),:).*repmat(squarecos2,129,1)';data_pad(length(data_pad)-(NPointsNew-NPointsold)+1:length(data_pad),:)];    % transform data    inv_conv_real = [];        data_trans = fft(data_tap, NPointsNew);    thetaMATLABretrans = [];             ProdMat= waveletMat .*(data_trans);        thetaMATLABretrans = ifft(ProdMat, NPointsNew);           % betrag %disp('computing .......     WApower/WARayleigh')WAPower = sqrt(real(thetaMATLABretrans).^2 + imag(thetaMATLABretrans).^2);WAPower =(WAPower)';WAPower = WAPower(:,1-NPointsold);    [File,Path,FilePath]=SaveAvgFile([deblank(filemat(fileindex,:)) '14.wamp'],WAPower,NTrialAvgVec,StdChanTimeMat, SampRate);end