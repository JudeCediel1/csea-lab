% Read data from several files (in the same directory) into 3D-array "data"% "elplist" may contain electrodes to exclude% "max_electrodes" is the number of channels (i.e. number of columns) in the files (the same for all files)% The number of remaining electrodes is output as "nr_electrodes"% If "ref_flag" is set to "avg", the data are average referenced (with respect to rows and remaining electrodes)% Number of rows can be arbitrary for all files, the individual number of rows is output% as vector "m"% O.H. 27.11.97function [data, m, nr_electrodes] = read_data_list(pathname, namelist, elplist, max_electrodes, ref_flag);nr_names = length(namelist(:,1));% Determine valid electrodes to be included in the following procedurenr_electrodes = 0;for i=1:max_electrodes,	pruef = 0;	for j=1:length(elplist),		if elplist(j)==i,			pruef = 1;			break;		end;	end;	if pruef==0,		nr_electrodes = nr_electrodes + 1;		arg(nr_electrodes) = i;	end;end;disp('Reading in data');if strcmp(ref_flag, 'avg'), disp('Average referencing'); end;for i=1:nr_names,	name = sprintf('%s\\%s', pathname, namelist(i,:));	disp(name);	matrix = read_matrix(100,max_electrodes,name);		% 50 is upper bound	[m(i) n(i)] = size(matrix); 	data(1:m(i),:, i) =  matrix(:,arg);	if strcmp(ref_flag, 'avg'), data(1:m(i),:, i) = avg_ref(data(1:m(i),:, i)')'; end;end;