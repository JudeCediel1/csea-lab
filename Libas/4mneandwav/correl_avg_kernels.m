function [correlations, kernels, kernels_cor] = correl_avg_kernels(lfdmat, regpar, elemrows, elemcor, nameout);if nargin==0,   disp(' [correlations, kernels, kernels_cor] = correl_avg_kernels(lfdmat, regpar, elemrows, elemcor, nameout); ');   return;end;disp(' Computing pseudoinverse ');G = pinv_tikh(lfdmat, regpar);disp(' Computing averaging kernels ');kernels = G(elemrows,:)*lfdmat;kernels_cor = G(elemcor,:)*lfdmat;norm_kernels = norm_col(kernels');norm_kernels_cor = norm_col(kernels_cor');disp(' Computing correlations ');for i=1:length(elemcor),   correlations(:,i) = (kernels_cor(i,:)*kernels')'/norm_kernels_cor(i);%   correlations(:,i) = (180/pi)*acos(correlations(:,i)./norm_kernels);   correlations(:,i) = abs(correlations(:,i)./norm_kernels);end;if ~isempty(nameout),   write_avr(correlations, nameout, 1, 1);end;