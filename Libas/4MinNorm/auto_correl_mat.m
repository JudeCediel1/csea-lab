% Create correlation matrix for the rows of a given matrix% Range of columns can be specified by from/to (default: all columns)% If a flag is specified with value 1, the mean of every row is removed before correlation% OH 22.10.1997, 29.10.97% Uses mean_columns() and norm_col()function C=auto_correl_mat(A, flag, from, to);[rA, cA] = size(A);if (nargin==1) | (nargin==2),	from = 1;	to = cA;end;% Remove mean from rows if flag specifiedif flag==1, 	meanA = mean_columns(A(:,from:to));	for i=1:rA		A2(i,:) = A(i,from:to) - meanA(i);	end;	nA = norm_col(A2');		% Compute norms of rows of A2	C = A2*A2';   % Matrix with scalar products of rows of A2	clear A2;else		nA = norm_col(A(:,from:to)');		% Compute norms of rows of A	C = A(:,from:to)*A(:,from:to)';     % Matrix with scalar products of rows of Aend;% Divide rows of C by norms of rows of Afor i=1:rA	C(i,:) = C(i,:)/nA(i);end;	% Divide columns of C by norms of rows of Afor i=1:rA	C(:,i) = C(:,i)/nA(i);end;