% Multiplication of (generalized) inverse ("inverse") with leadfield matrix ("lfdmat") (=> averaging kernels)% If "dim"~=1, "dim" columns of the leadfield are considered to belong to one location in the source space% and for the solution only the absolute value for every location is output% There must be equally many measurement points (electrodes, sensors) as inverse coefficients% Different rows of "kernel" correspond to different locations in the source space% Different columns of "kernel" correspond to different solution points (rows of the inverse)% OH 27.11.97function [kernel] = avg_kernel(inverse, lfdmat, dim);if nargin==0,   disp(' [kernel] = avg_kernel(inverse, lfdmat, dim); ');   return;end;[mi ni] = size(inverse);[ml nl] = size(lfdmat);if (nargin==2)	dim = 1;end;if ni~=ml,	disp(' Measurement points and inverse coefficients do not match!!! (avg_kern) ');	return;end;if mod(nl,dim)~=0,	disp(' Dimension of sourcespace incompatible with number of solution points!!! (avg_kern) ');	return;end;if (nargin==2) | (dim==1),	kernel = inverse*lfdmat;else	cnt = 1;	for i=1:dim:nl,			% Solution points (vectors)		comp = inverse*lfdmat(:,i:i+dim-1);      for j=1:mi			% Rows of inverse         kernel(cnt,j) = norm(comp(j,:));					end;		cnt = cnt+1;	end;end;