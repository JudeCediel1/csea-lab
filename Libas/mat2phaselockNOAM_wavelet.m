function[PLImat1]=mat2phaselockNOAM_wavelet(matfilemat, confilemat, refsensor, SampRate);% reads EEG.data array previously stored to disk as a mat file with 3-d% elcs time trials, averages for conditions it finds in text file with% condition information (3 conditions) does phase locking, and saves as atg filesfor index = 1:size(matfilemat,1);         confilepath = deblank(confilemat(index,:));         if ~isstruct(matfilemat);         atgPath = deblank(matfilemat(index,:));    else        atgPath = matfilemat(index).name;     end	  a = load(atgPath);   EEGdata3d = double(a.datamat);  conditions = load(confilepath);      % assemble trials for pleasant, neutral, unpleasant           submatpleasant = EEGdata3d(:,:,find(conditions==1));       submatneutral = EEGdata3d(:,:,find(conditions ==2));       submatunpleasant = EEGdata3d(:,:,find(conditions==3));            % pleasant       [WaPower, PLI, PLIdiff] = wavelet_app_mat(submatpleasant, 250, 87, 87, 1, refsensor);        [File,Path,FilePath]=SaveAvgFile([atgPath '.PLIdiff.' num2str(refsensor) '.at.P' ],PLIdiff,[],[], SampRate);              % neutral         [WaPower, PLI, PLIdiff] = wavelet_app_mat(submatneutral, 250, 87, 87, 1, refsensor);            [File,Path,FilePath]=SaveAvgFile([atgPath '.PLIdiff.' num2str(refsensor) '.at.N' ],PLIdiff,[],[], SampRate);                       % unpleasant    [WaPower, PLI, PLIdiff] = wavelet_app_mat(submatunpleasant, 250, 87, 87, 1, refsensor);   [File,Path,FilePath]=SaveAvgFile([atgPath '.PLIdiff.' num2str(refsensor) '.at.U' ],PLIdiff,[],[], SampRate);          end